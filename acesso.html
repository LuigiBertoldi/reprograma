<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Conseguir Ajuda | Reprograma 30</title>
  <meta name="description" content="Acesse sua √°rea do Reprograma 30, crie seu perfil e inicie sua trilha personalizada." />
  <meta name="theme-color" content="#0b1020" />

  <style>
    :root{
      --bg:#070b14;
      --bg2:#0d1426;
      --panel:rgba(255,255,255,.04);
      --panel-2:rgba(255,255,255,.03);
      --line:rgba(255,255,255,.10);
      --line-strong:rgba(255,255,255,.16);
      --text:#edf2ff;
      --muted:#aeb7cc;
      --muted2:#8d97ad;
      --accent:#7d5cff;
      --accent2:#2fd4ff;
      --ok:#35d07f;
      --warn:#ffcc66;
      --bad:#ff6b85;
      --shadow:0 20px 70px rgba(0,0,0,.42);
      --radius:18px;
      --radius-xl:26px;
      --max:1200px;
    }

    *{box-sizing:border-box}
    html,body{
      margin:0; padding:0;
      color:var(--text);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1000px 650px at 5% 0%, rgba(125,92,255,.22), transparent 58%),
        radial-gradient(900px 620px at 95% 10%, rgba(47,212,255,.14), transparent 58%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      min-height:100vh;
    }

    a{color:inherit;text-decoration:none}
    button,input,select,textarea{font:inherit}
    .wrap{max-width:var(--max);margin:0 auto;padding:0 18px}

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:40;
      backdrop-filter: blur(10px);
      background: rgba(7,11,20,.75);
      border-bottom:1px solid var(--line);
    }
    .topbar-in{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px; padding:14px 0;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .brand-logo{
      width:40px;height:40px;border-radius:14px;
      background: linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow: 0 12px 35px rgba(125,92,255,.35);
      display:grid; place-items:center; font-weight:900; color:#08111f;
      letter-spacing:.2px;
    }
    .brand-txt{line-height:1.05}
    .brand-title{font-weight:900; font-size:15px}
    .brand-sub{font-size:12px; color:var(--muted)}
    .top-actions{display:flex; gap:8px; flex-wrap:wrap}

    /* Buttons */
    .btn{
      border:1px solid transparent;
      background: transparent;
      color:var(--text);
      padding:12px 14px;
      border-radius:999px;
      font-weight:800;
      font-size:14px;
      cursor:pointer;
      transition:.18s ease;
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      white-space:nowrap;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn-primary{
      background: linear-gradient(135deg,var(--accent),var(--accent2));
      color:#07101d;
      box-shadow: 0 12px 35px rgba(125,92,255,.28);
    }
    .btn-ghost{
      border-color:var(--line);
      background: rgba(255,255,255,.03);
    }
    .btn-soft{
      border-color:rgba(255,255,255,.08);
      background: rgba(255,255,255,.05);
      color:var(--text);
    }
    .btn-danger{
      background: rgba(255,107,133,.12);
      border-color: rgba(255,107,133,.28);
      color:#ffd2dc;
    }
    .btn-full{width:100%}
    .btn-sm{padding:9px 12px; font-size:13px}

    /* Layout */
    .main{padding:24px 0 40px}
    .hero{
      border:1px solid var(--line);
      border-radius:var(--radius-xl);
      background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      margin-bottom:16px;
    }
    .hero:before{
      content:"";
      position:absolute; right:-80px; top:-80px;
      width:260px;height:260px;border-radius:50%;
      background: radial-gradient(circle, rgba(47,212,255,.25), transparent 65%);
      pointer-events:none;
    }
    .hero-in{
      padding:22px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
      align-items:stretch;
    }

    .badge-row{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}
    .pill{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      padding:7px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background: var(--ok); display:inline-block; margin-right:6px;
      box-shadow:0 0 0 4px rgba(53,208,127,.14);
      vertical-align:middle;
    }

    h1{
      margin:0 0 10px;
      font-size:clamp(28px, 4vw, 42px);
      line-height:1.05;
      letter-spacing:-.6px;
    }
    .hero-sub{
      margin:0;
      color:var(--muted);
      line-height:1.6;
      font-size:15px;
      max-width:58ch;
    }
    .hero-list{
      margin:12px 0 0; padding:0; list-style:none;
      display:grid; gap:8px;
    }
    .hero-list li{
      display:flex; gap:10px; align-items:flex-start;
      color:var(--muted); font-size:13px;
    }
    .check{
      width:18px;height:18px; border-radius:6px;
      border:1px solid rgba(53,208,127,.28);
      background: rgba(53,208,127,.14);
      color:var(--ok); display:grid; place-items:center;
      font-weight:900; flex:0 0 auto; margin-top:1px;
    }

    .panel{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: var(--panel);
      padding:16px;
    }
    .panel h2{
      margin:0 0 6px; font-size:18px; letter-spacing:-.2px;
    }
    .panel p{
      margin:0; color:var(--muted); font-size:13px; line-height:1.55;
    }

    .grid{
      display:grid; gap:14px;
      grid-template-columns: 1.05fr .95fr;
      align-items:start;
    }

    /* Auth card */
    .auth-card{
      border:1px solid var(--line);
      border-radius: var(--radius-xl);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .auth-head{
      padding:18px 18px 10px;
      border-bottom:1px solid rgba(255,255,255,.05);
    }
    .auth-title{
      font-size:20px; font-weight:900; margin:0 0 6px;
    }
    .auth-desc{
      margin:0; color:var(--muted); font-size:13px; line-height:1.55;
    }
    .tabs{
      margin-top:12px;
      display:grid; grid-template-columns:1fr 1fr;
      gap:8px;
      background: rgba(255,255,255,.02);
      border:1px solid var(--line);
      padding:6px;
      border-radius:14px;
    }
    .tab{
      border:none;
      background: transparent;
      color: var(--muted);
      padding:10px;
      border-radius:10px;
      font-weight:800;
      cursor:pointer;
    }
    .tab.active{
      background: rgba(255,255,255,.06);
      color: var(--text);
      border:1px solid rgba(255,255,255,.08);
    }

    .auth-body{padding:16px 18px 18px}
    .form-grid{display:grid; gap:12px}
    .field{display:grid; gap:7px}
    .field label{
      font-size:12px; color:var(--muted); font-weight:700;
    }
    .input, .select, .textarea{
      width:100%;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      border-radius:12px;
      padding:12px 13px;
      outline:none;
      transition:.16s ease;
    }
    .input::placeholder, .textarea::placeholder{color:#97a2bb}
    .input:focus, .select:focus, .textarea:focus{
      border-color: rgba(47,212,255,.38);
      box-shadow: 0 0 0 4px rgba(47,212,255,.08);
      background: rgba(255,255,255,.04);
    }
    .textarea{min-height:88px; resize:vertical}

    .row{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .row-2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .helper{
      color:var(--muted2);
      font-size:12px; line-height:1.45;
    }
    .divider{
      height:1px;background:var(--line);margin:12px 0;
    }
    .small-link{
      color:#c6d5ff; font-size:12px; cursor:pointer;
      text-decoration:underline;
      text-underline-offset: 2px;
    }
    .error{
      border:1px solid rgba(255,107,133,.25);
      background: rgba(255,107,133,.08);
      color:#ffd0da;
      border-radius:12px;
      padding:10px 12px;
      font-size:12px;
      display:none;
    }
    .success{
      border:1px solid rgba(53,208,127,.25);
      background: rgba(53,208,127,.08);
      color:#c8f7dc;
      border-radius:12px;
      padding:10px 12px;
      font-size:12px;
      display:none;
    }

    /* Side cards */
    .stack{display:grid; gap:14px}
    .mini-card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: var(--panel);
      padding:14px;
    }
    .mini-card h3{
      margin:0 0 8px; font-size:15px;
    }
    .mini-card p{
      margin:0; color:var(--muted); font-size:13px; line-height:1.55;
    }
    .list{
      display:grid; gap:9px; margin-top:10px;
    }
    .list-item{
      display:flex; gap:10px; align-items:flex-start;
      color:var(--muted); font-size:13px; line-height:1.4;
    }

    /* Onboarding + Dashboard views */
    .hidden{display:none !important}

    .wizard{
      display:grid; gap:14px;
      grid-template-columns: 1fr;
    }
    .stepper{
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .step-pill{
      border:1px solid var(--line);
      background: rgba(255,255,255,.02);
      color:var(--muted);
      border-radius:999px;
      padding:7px 10px;
      font-size:12px;
      font-weight:700;
    }
    .step-pill.active{
      color:var(--text);
      border-color:rgba(47,212,255,.28);
      background: rgba(47,212,255,.08);
    }
    .step-panel{
      border:1px solid var(--line);
      border-radius: var(--radius-xl);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      padding:18px;
    }
    .step-title{margin:0 0 6px; font-size:22px; letter-spacing:-.2px}
    .step-sub{margin:0; color:var(--muted); font-size:13px; line-height:1.55}

    .choices{
      display:grid; gap:10px; margin-top:12px;
    }
    .choice{
      border:1px solid var(--line);
      background: rgba(255,255,255,.025);
      border-radius:14px;
      padding:12px;
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:10px;
      cursor:pointer;
      transition:.16s ease;
    }
    .choice:hover{
      transform:translateY(-1px);
      border-color: rgba(47,212,255,.28);
      background: rgba(255,255,255,.04);
    }
    .choice.active{
      border-color: rgba(125,92,255,.35);
      box-shadow: inset 0 0 0 1px rgba(125,92,255,.18);
      background: rgba(125,92,255,.08);
    }
    .choice h4{margin:0 0 6px; font-size:14px}
    .choice p{margin:0; color:var(--muted); font-size:12px; line-height:1.5}
    .tag{
      border:1px solid var(--line);
      border-radius:999px;
      padding:5px 8px;
      font-size:11px;
      color:var(--muted);
      white-space:nowrap;
    }

    .assessment{
      margin-top:12px;
      display:grid;
      gap:12px;
    }
    .ass-card{
      border:1px solid var(--line);
      background: rgba(255,255,255,.025);
      border-radius:14px;
      padding:12px;
    }
    .ass-top{
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      margin-bottom:10px;
    }
    .ass-title{font-weight:900; font-size:14px}
    .score-chip{
      border:1px solid var(--line);
      border-radius:999px;
      padding:5px 8px;
      font-size:11px;
      color:var(--muted);
    }
    .q{
      display:grid; gap:8px;
      margin-top:10px;
    }
    .q-row{
      display:grid;
      grid-template-columns: 1.6fr 1fr;
      gap:8px;
      align-items:center;
      border:1px solid rgba(255,255,255,.05);
      border-radius:12px;
      padding:10px;
      background: rgba(255,255,255,.015);
    }
    .q-label{
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }
    .q-select{
      width:100%;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      border-radius:10px;
      padding:9px 10px;
    }

    /* Dashboard */
    .dash-grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      margin-top:14px;
    }
    .dash-card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: var(--panel);
      padding:14px;
    }
    .dash-card h3{margin:0 0 10px; font-size:16px}
    .dash-card p{margin:0; color:var(--muted); font-size:13px; line-height:1.55}
    .kpis{
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:10px;
      margin-top:10px;
    }
    .kpi{
      border:1px solid var(--line);
      background: rgba(0,0,0,.14);
      border-radius:14px;
      padding:12px;
    }
    .kpi .k-label{font-size:11px; color:var(--muted)}
    .kpi .k-value{font-weight:900; margin-top:4px; font-size:18px}
    .progress{
      height:10px; border-radius:999px;
      overflow:hidden;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.04);
      margin-top:8px;
    }
    .bar{
      height:100%; width:0%;
      background: linear-gradient(90deg,var(--accent),var(--accent2));
    }

    .badge-list{display:grid; gap:8px; margin-top:10px}
    .badge-item{
      border:1px solid var(--line);
      border-radius:12px;
      background: rgba(255,255,255,.02);
      padding:10px 12px;
      display:flex; justify-content:space-between; gap:8px;
      font-size:12px;
    }
    .badge-item .status{
      font-weight:800;
    }
    .status.ok{color:#bcf6d7}
    .status.lock{color:var(--muted2)}

    .risk-list{display:grid; gap:8px; margin-top:10px}
    .risk-row{
      display:grid;
      grid-template-columns: 110px 1fr 74px;
      gap:8px;
      align-items:center;
      font-size:12px;
      color:var(--muted);
    }
    .risk-bar{
      height:8px; border-radius:999px;
      background: rgba(255,255,255,.07);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.04);
    }
    .risk-fill{height:100%; width:0%; background:linear-gradient(90deg, var(--warn), var(--bad))}
    .risk-num{text-align:right; font-weight:800; color:var(--text)}

    .footer{
      margin-top:16px;
      border-top:1px solid var(--line);
      padding-top:14px;
      color:var(--muted2);
      font-size:12px;
      line-height:1.5;
    }

    .toast{
      position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
      border:1px solid var(--line);
      background: rgba(0,0,0,.65);
      color:var(--text);
      border-radius:999px;
      padding:10px 12px;
      font-size:13px;
      display:none;
      z-index:200;
      backdrop-filter: blur(10px);
    }

    @media (max-width: 1040px){
      .hero-in, .grid, .dash-grid{grid-template-columns:1fr}
      .hero{margin-bottom:14px}
    }
    @media (max-width: 720px){
      .topbar-in{align-items:flex-start; flex-direction:column}
      .top-actions{width:100%}
      .top-actions .btn{flex:1}
      .row-2{grid-template-columns:1fr}
      .q-row{grid-template-columns:1fr}
      .kpis{grid-template-columns:1fr}
      .risk-row{grid-template-columns: 90px 1fr 62px}
      .auth-title{font-size:18px}
      .step-title{font-size:19px}
      .hero-in{padding:16px}
      .auth-head,.auth-body,.step-panel{padding:14px}
    }
  </style>
</head>
<body>
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="wrap topbar-in">
      <a class="brand" href="/" id="goLanding">
        <div class="brand-logo">R30</div>
        <div class="brand-txt">
          <div class="brand-title">Reprograma 30</div>
          <div class="brand-sub">Acessar minha ajuda ‚Ä¢ √Årea personalizada</div>
        </div>
      </a>

      <div class="top-actions">
        <button class="btn btn-ghost btn-sm" id="btnShowCrisis">Modo Crise</button>
        <button class="btn btn-soft btn-sm" id="btnGoAuth">Entrar / Criar conta</button>
        <button class="btn btn-primary btn-sm hidden" id="btnLogoutTop">Sair</button>
      </div>
    </div>
  </div>

  <main class="main">
    <div class="wrap">

      <!-- HERO -->
      <section class="hero" id="heroSection">
        <div class="hero-in">
          <div>
            <div class="badge-row">
              <span class="pill"><span class="dot"></span>Apoio educacional/comportamental</span>
              <span class="pill">Apostas ‚Ä¢ √Ålcool ‚Ä¢ Fumar ‚Ä¢ Pornografia ‚Ä¢ Drogas</span>
            </div>
            <h1>Conseguir ajuda come√ßa com um passo simples.</h1>
            <p class="hero-sub">
              Se voc√™ j√° comprou o <b>Reprograma 30</b>, crie sua conta para acessar sua √°rea personalizada,
              montar seu perfil, entender seu n√≠vel de impacto em cada trilha e iniciar seu plano.
            </p>

            <ul class="hero-list">
              <li><span class="check">‚úì</span><span>Cria√ß√£o de conta e perfil em poucos minutos</span></li>
              <li><span class="check">‚úì</span><span>Autoavalia√ß√£o inicial (sem julgamento, focada em progresso)</span></li>
              <li><span class="check">‚úì</span><span>Trilha principal + dashboard de acompanhamento</span></li>
            </ul>

            <div class="row" style="margin-top:14px">
              <button class="btn btn-primary" id="btnHeroStart">Acessar minha ajuda</button>
              <button class="btn btn-ghost" id="btnHeroHow">Como funciona</button>
            </div>

            <div class="divider"></div>
            <div class="helper">
              Dica: use o <b>mesmo e-mail da compra</b> (Kiwify) para facilitar valida√ß√£o futura do seu acesso.
            </div>
          </div>

          <div class="panel">
            <h2>Fluxo recomendado (p√≥s-compra)</h2>
            <p>
              1) Compra confirmada (Kiwify) ‚Üí 2) E-mail recebido ‚Üí 3) Entrar no Reprograma 30 ‚Üí
              4) Criar perfil ‚Üí 5) Autoavalia√ß√£o ‚Üí 6) Come√ßar trilha.
            </p>

            <div class="divider"></div>

            <h2 style="font-size:16px">Aviso importante</h2>
            <p>
              Esta plataforma oferece <b>apoio educacional/comportamental</b>. N√£o substitui atendimento m√©dico,
              psicol√≥gico ou psiqui√°trico. Em risco de seguran√ßa, procure ajuda profissional imediatamente.
            </p>

            <div class="divider"></div>

            <div class="row">
              <button class="btn btn-soft btn-full" id="btnDemoFill">Preencher demo r√°pido</button>
            </div>
          </div>
        </div>
      </section>

      <!-- AUTH + INFO -->
      <section class="grid" id="authLayout">
        <!-- AUTH CARD -->
        <div class="auth-card" id="authCard">
          <div class="auth-head">
            <h2 class="auth-title">Acessar minha ajuda</h2>
            <p class="auth-desc">
              Entre na sua conta ou crie seu acesso para iniciar sua jornada no Reprograma 30.
            </p>

            <div class="tabs">
              <button class="tab active" id="tabLogin">Entrar</button>
              <button class="tab" id="tabSignup">Criar conta</button>
            </div>
          </div>

          <div class="auth-body">
            <div class="error" id="authError"></div>
            <div class="success" id="authSuccess"></div>

            <!-- LOGIN FORM -->
            <form id="formLogin" class="form-grid">
              <div class="field">
                <label for="loginEmail">E-mail</label>
                <input class="input" id="loginEmail" type="email" placeholder="voce@email.com" required />
              </div>

              <div class="field">
                <label for="loginPassword">Senha</label>
                <input class="input" id="loginPassword" type="password" placeholder="Digite sua senha" required />
              </div>

              <div class="row" style="justify-content:space-between;align-items:center">
                <span class="helper">Use o e-mail da compra, se poss√≠vel.</span>
                <button type="button" class="small-link" id="btnForgot">Esqueci minha senha</button>
              </div>

              <button class="btn btn-primary btn-full" type="submit">Entrar na minha √°rea</button>

              <div class="helper">
                Ainda n√£o tem conta? <button type="button" class="small-link" id="btnToSignup">Criar agora</button>
              </div>
            </form>

            <!-- SIGNUP FORM -->
            <form id="formSignup" class="form-grid hidden">
              <div class="row-2">
                <div class="field">
                  <label for="signupName">Nome</label>
                  <input class="input" id="signupName" type="text" placeholder="Seu nome" />
                </div>
                <div class="field">
                  <label for="signupNick">Apelido (opcional)</label>
                  <input class="input" id="signupNick" type="text" placeholder="Como prefere ser chamado" />
                </div>
              </div>

              <div class="field">
                <label for="signupEmail">E-mail (de prefer√™ncia o da compra)</label>
                <input class="input" id="signupEmail" type="email" placeholder="voce@email.com" required />
              </div>

              <div class="row-2">
                <div class="field">
                  <label for="signupPassword">Senha</label>
                  <input class="input" id="signupPassword" type="password" placeholder="Crie uma senha" required />
                </div>
                <div class="field">
                  <label for="signupPassword2">Confirmar senha</label>
                  <input class="input" id="signupPassword2" type="password" placeholder="Repita a senha" required />
                </div>
              </div>

              <div class="field">
                <label for="signupGoal">Objetivo principal (opcional)</label>
                <textarea class="textarea" id="signupGoal" placeholder="Ex.: reduzir reca√≠das, recuperar foco, economizar dinheiro, melhorar minha rotina..."></textarea>
              </div>

              <div class="helper">
                Ao criar conta, voc√™ seguir√° para uma autoavalia√ß√£o r√°pida para personalizar sua trilha.
              </div>

              <button class="btn btn-primary btn-full" type="submit">Criar conta e montar meu perfil</button>

              <div class="helper">
                J√° tem conta? <button type="button" class="small-link" id="btnToLogin">Entrar</button>
              </div>
            </form>
          </div>
        </div>

        <!-- SIDE INFO -->
        <aside class="stack" id="sideInfo">
          <div class="mini-card">
            <h3>Como funciona a autoavalia√ß√£o</h3>
            <p>
              Voc√™ responde perguntas r√°pidas de impacto percebido para cada trilha (apostas, √°lcool, fumar,
              pornografia e drogas). O sistema cria um mapa inicial para orientar seu foco.
            </p>
            <div class="list">
              <div class="list-item"><span class="check">‚úì</span><span>N√£o √© diagn√≥stico cl√≠nico</span></div>
              <div class="list-item"><span class="check">‚úì</span><span>Sem julgamento, focado em clareza</span></div>
              <div class="list-item"><span class="check">‚úì</span><span>Pode refazer depois para comparar evolu√ß√£o</span></div>
            </div>
          </div>

          <div class="mini-card">
            <h3>O que voc√™ ter√° na sua √°rea</h3>
            <p>Depois de criar o acesso e finalizar seu perfil, voc√™ ter√° um painel com:</p>
            <div class="list">
              <div class="list-item"><span class="check">‚úì</span><span>Trilha principal sugerida</span></div>
              <div class="list-item"><span class="check">‚úì</span><span>Progresso e check-in di√°rio</span></div>
              <div class="list-item"><span class="check">‚úì</span><span>Modo Crise (a√ß√£o r√°pida)</span></div>
              <div class="list-item"><span class="check">‚úì</span><span>Badges, metas e retomada</span></div>
            </div>
          </div>

          <div class="mini-card">
            <h3>Problemas para acessar?</h3>
            <p>
              Se voc√™ j√° comprou e estiver com dificuldade, confira o e-mail da compra e tamb√©m a caixa de spam.
              Depois, tente criar sua conta usando o mesmo e-mail utilizado no checkout.
            </p>
            <div class="divider"></div>
            <div class="helper">Em produ√ß√£o, voc√™ pode adicionar aqui: WhatsApp, e-mail de suporte ou formul√°rio.</div>
          </div>
        </aside>
      </section>

      <!-- ONBOARDING -->
      <section class="wizard hidden" id="onboardingSection">
        <div class="step-panel">
          <div class="stepper" id="stepper">
            <span class="step-pill active" data-step="1">1. Perfil</span>
            <span class="step-pill" data-step="2">2. Trilha principal</span>
            <span class="step-pill" data-step="3">3. Autoavalia√ß√£o</span>
            <span class="step-pill" data-step="4">4. Finalizar</span>
          </div>

          <div class="divider"></div>

          <!-- STEP 1 -->
          <div id="step1">
            <h2 class="step-title">Vamos montar seu perfil de apoio</h2>
            <p class="step-sub">
              Isso leva de 2 a 4 minutos. As respostas servem para personalizar sua experi√™ncia no Reprograma 30.
            </p>

            <div class="form-grid" style="margin-top:14px">
              <div class="row-2">
                <div class="field">
                  <label for="obName">Nome</label>
                  <input class="input" id="obName" type="text" placeholder="Seu nome" />
                </div>
                <div class="field">
                  <label for="obNick">Apelido (opcional)</label>
                  <input class="input" id="obNick" type="text" placeholder="Como prefere ser chamado" />
                </div>
              </div>

              <div class="field">
                <label for="obGoal">Objetivo principal</label>
                <textarea class="textarea" id="obGoal" placeholder="Ex.: quero reduzir reca√≠das, voltar a ter foco, economizar dinheiro, dormir melhor..."></textarea>
              </div>

              <div class="row" style="justify-content:flex-end">
                <button class="btn btn-primary" id="nextStep1">Continuar</button>
              </div>
            </div>
          </div>

          <!-- STEP 2 -->
          <div id="step2" class="hidden">
            <h2 class="step-title">Qual trilha mais te prejudica hoje?</h2>
            <p class="step-sub">
              Escolha a principal. Depois voc√™ poder√° acessar outras trilhas e ajustar isso no perfil.
            </p>

            <div class="choices" id="mainTrackChoices">
              <div class="choice" data-track="apostas">
                <div>
                  <h4>üéØ Apostas</h4>
                  <p>Impulso digital, perda de dinheiro, ansiedade, ‚Äús√≥ mais uma‚Äù.</p>
                </div>
                <span class="tag">urg√™ncia</span>
              </div>

              <div class="choice" data-track="alcool">
                <div>
                  <h4>üç∫ √Ålcool</h4>
                  <p>Gatilhos sociais, estresse, fim de semana, reca√≠das repetidas.</p>
                </div>
                <span class="tag">social</span>
              </div>

              <div class="choice" data-track="fumar">
                <div>
                  <h4>üö¨ Fumar</h4>
                  <p>H√°bito autom√°tico, ‚Äúpausa‚Äù, ansiedade e rotina condicionada.</p>
                </div>
                <span class="tag">h√°bito</span>
              </div>

              <div class="choice" data-track="pornografia">
                <div>
                  <h4>üß† Pornografia</h4>
                  <p>Compuls√£o digital, escapismo, culpa, queda de foco/energia.</p>
                </div>
                <span class="tag">digital</span>
              </div>

              <div class="choice" data-track="drogas">
                <div>
                  <h4>‚ö†Ô∏è Drogas</h4>
                  <p>Ambiente, companhia, fuga emocional, reca√≠da por gatilhos sociais.</p>
                </div>
                <span class="tag">aten√ß√£o</span>
              </div>
            </div>

            <div class="row" style="justify-content:space-between;margin-top:12px">
              <button class="btn btn-ghost" id="backStep2">Voltar</button>
              <button class="btn btn-primary" id="nextStep2">Continuar</button>
            </div>
          </div>

          <!-- STEP 3 -->
          <div id="step3" class="hidden">
            <h2 class="step-title">Autoavalia√ß√£o inicial (mapa de impacto)</h2>
            <p class="step-sub">
              Marque o quanto cada item impacta sua vida hoje. Isso n√£o √© diagn√≥stico cl√≠nico.
            </p>

            <div class="assessment" id="assessmentContainer"></div>

            <div class="row" style="justify-content:space-between;margin-top:12px">
              <button class="btn btn-ghost" id="backStep3">Voltar</button>
              <button class="btn btn-primary" id="nextStep3">Ver resultado e finalizar</button>
            </div>
          </div>

          <!-- STEP 4 -->
          <div id="step4" class="hidden">
            <h2 class="step-title">Seu perfil inicial est√° pronto ‚úÖ</h2>
            <p class="step-sub">
              Aqui est√° seu mapa inicial. Voc√™ poder√° atualizar isso depois na sua √°rea.
            </p>

            <div class="dash-grid" style="margin-top:12px">
              <div class="dash-card">
                <h3>Resumo do seu perfil</h3>
                <div class="kpis">
                  <div class="kpi">
                    <div class="k-label">Nome</div>
                    <div class="k-value" id="rName">‚Äî</div>
                  </div>
                  <div class="kpi">
                    <div class="k-label">Trilha principal</div>
                    <div class="k-value" id="rMainTrack">‚Äî</div>
                  </div>
                  <div class="kpi">
                    <div class="k-label">N√≠vel principal</div>
                    <div class="k-value" id="rLevel">‚Äî</div>
                  </div>
                </div>

                <div class="divider"></div>

                <h3 style="margin-top:0">Mapa de impacto inicial</h3>
                <div class="risk-list" id="resultRiskList"></div>
              </div>

              <div class="dash-card">
                <h3>Pr√≥ximo passo</h3>
                <p>
                  Agora voc√™ pode entrar no seu dashboard para come√ßar sua trilha, usar o Modo Crise e registrar check-ins.
                </p>

                <div class="divider"></div>
                <p class="helper">
                  Em produ√ß√£o: aqui voc√™ pode validar se a pessoa √© assinante ativo (Kiwify) e liberar acesso premium.
                </p>

                <div class="row" style="margin-top:12px">
                  <button class="btn btn-primary btn-full" id="finishOnboarding">Ir para meu dashboard</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- DASHBOARD -->
      <section class="hidden" id="dashboardSection">
        <div class="hero" style="margin-bottom:14px">
          <div class="hero-in">
            <div>
              <div class="badge-row">
                <span class="pill">√Årea privada ‚Ä¢ Reprograma 30</span>
                <span class="pill" id="dashUserEmail">‚Äî</span>
              </div>
              <h1 style="font-size:clamp(24px,3vw,34px)">Bem-vindo, <span id="dashName">‚Äî</span></h1>
              <p class="hero-sub" id="dashSubtitle">
                Seu painel inicial est√° pronto. Comece pela sua trilha principal e fa√ßa seu check-in di√°rio.
              </p>

              <div class="row" style="margin-top:14px">
                <button class="btn btn-primary" id="btnStartTrack">Come√ßar trilha principal</button>
                <button class="btn btn-ghost" id="btnCrisisDash">Modo Crise</button>
                <button class="btn btn-soft" id="btnRedoAssessment">Refazer autoavalia√ß√£o</button>
              </div>
            </div>

            <div class="panel">
              <h2>Resumo r√°pido</h2>
              <p id="dashQuickSummary">Carregando...</p>

              <div class="divider"></div>
              <div class="kpis">
                <div class="kpi">
                  <div class="k-label">Trilha principal</div>
                  <div class="k-value" id="dashMainTrack">‚Äî</div>
                </div>
                <div class="kpi">
                  <div class="k-label">N√≠vel atual</div>
                  <div class="k-value" id="dashMainLevel">‚Äî</div>
                </div>
                <div class="kpi">
                  <div class="k-label">Check-ins (demo)</div>
                  <div class="k-value" id="dashCheckins">0</div>
                </div>
              </div>

              <div class="divider"></div>
              <div class="helper">
                Este demo salva dados localmente no navegador. Depois voc√™ pode integrar com Supabase para login real + banco.
              </div>
            </div>
          </div>
        </div>

        <div class="dash-grid">
          <div class="dash-card">
            <h3>Seu mapa de impacto (inicial)</h3>
            <p>Use isso como base para foco, n√£o como r√≥tulo.</p>
            <div class="risk-list" id="dashRiskList"></div>

            <div class="divider"></div>
            <h3 style="margin-top:0">Progresso (demo local)</h3>
            <p>Registro simples para visualizar consist√™ncia.</p>

            <div class="row-2" style="margin-top:10px">
              <div class="field">
                <label for="checkStatus">Como foi hoje?</label>
                <select class="select" id="checkStatus">
                  <option value="ok">N√£o ca√≠</option>
                  <option value="slip">Quase ca√≠</option>
                  <option value="relapse">Ca√≠</option>
                </select>
              </div>
              <div class="field">
                <label for="checkUrge">Vontade (0 a 5)</label>
                <select class="select" id="checkUrge">
                  <option>0</option><option>1</option><option selected>2</option><option>3</option><option>4</option><option>5</option>
                </select>
              </div>
            </div>

            <div class="field" style="margin-top:10px">
              <label for="checkTrigger">Gatilho principal</label>
              <select class="select" id="checkTrigger">
                <option>T√©dio</option>
                <option>Ansiedade/Estresse</option>
                <option>Solid√£o/Tristeza</option>
                <option>Ambiente/Social</option>
                <option>Celular/Feed</option>
              </select>
            </div>

            <div class="row" style="margin-top:12px">
              <button class="btn btn-primary" id="btnSaveCheckin">Salvar check-in</button>
              <button class="btn btn-ghost" id="btnResetCheckin">Zerar check-ins</button>
            </div>
          </div>

          <div class="stack">
            <div class="dash-card">
              <h3>Meta de 30 dias (visual)</h3>
              <p>Barra simples de progresso para manter voc√™ em movimento.</p>
              <div class="progress"><div class="bar" id="mainProgressBar"></div></div>
              <div class="helper" id="mainProgressText" style="margin-top:8px">0/30 dias (demo)</div>
            </div>

            <div class="dash-card">
              <h3>Badges (demo)</h3>
              <p>Recompensas visuais por consist√™ncia.</p>
              <div class="badge-list" id="dashBadges"></div>
            </div>

            <div class="dash-card">
              <h3>Modo Crise (resumo)</h3>
              <p>
                Quando bater vontade forte: respire, corte o gatilho, fa√ßa uma a√ß√£o r√°pida, nomeie a emo√ß√£o
                e volte para o check-in.
              </p>
              <div class="row" style="margin-top:10px">
                <button class="btn btn-soft btn-full" id="btnOpenCrisisCard">Abrir protocolo</button>
              </div>
            </div>
          </div>
        </div>

        <div class="footer">
          Reprograma 30 oferece apoio educacional/comportamental. N√£o substitui tratamento profissional. Em situa√ß√µes de risco, procure ajuda imediata.
        </div>
      </section>
    </div>
  </main>

  <div class="toast" id="toast"></div>

  <script>
    // =========================
    // DEMO LOCAL (sem backend)
    // =========================
    // Depois voc√™ pode trocar por Supabase (auth + banco)
    // Mantive tudo organizado pra facilitar a futura integra√ß√£o.

    const $ = (id) => document.getElementById(id);
    const toast = (msg) => {
      const el = $("toast");
      el.textContent = msg;
      el.style.display = "block";
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(() => el.style.display = "none", 2400);
    };

    const STORE_KEYS = {
      USERS: "rp30_users_demo_v1",        // array de usu√°rios cadastrados localmente
      SESSION: "rp30_session_demo_v1",    // sess√£o atual
      CHECKINS: "rp30_checkins_demo_v1"   // check-ins por userId
    };

    const TRACKS = {
      apostas: { label: "Apostas", emoji: "üéØ" },
      alcool: { label: "√Ålcool", emoji: "üç∫" },
      fumar: { label: "Fumar", emoji: "üö¨" },
      pornografia: { label: "Pornografia", emoji: "üß†" },
      drogas: { label: "Drogas", emoji: "‚ö†Ô∏è" }
    };

    const QUESTIONS = [
      "Isso atrapalha minha rotina?",
      "Isso afeta meu sono/energia?",
      "Isso gera culpa/arrependimento?",
      "Tenho dificuldade de controlar quando come√ßa?",
      "Isso afeta dinheiro/relacionamento/trabalho?"
    ];

    let onboardingState = {
      step: 1,
      selectedTrack: null,
      assessments: {}, // ex.: {apostas:[1,2,3,4,1], ...}
      result: null
    };

    // ---------- Storage Helpers ----------
    function getUsers(){
      try { return JSON.parse(localStorage.getItem(STORE_KEYS.USERS) || "[]"); }
      catch { return []; }
    }
    function setUsers(users){
      localStorage.setItem(STORE_KEYS.USERS, JSON.stringify(users));
    }
    function getSession(){
      try { return JSON.parse(localStorage.getItem(STORE_KEYS.SESSION) || "null"); }
      catch { return null; }
    }
    function setSession(session){
      localStorage.setItem(STORE_KEYS.SESSION, JSON.stringify(session));
    }
    function clearSession(){
      localStorage.removeItem(STORE_KEYS.SESSION);
    }
    function getCheckins(){
      try { return JSON.parse(localStorage.getItem(STORE_KEYS.CHECKINS) || "{}"); }
      catch { return {}; }
    }
    function setCheckins(data){
      localStorage.setItem(STORE_KEYS.CHECKINS, JSON.stringify(data));
    }

    // ---------- UI State ----------
    function switchAuthTab(tab){
      const isLogin = tab === "login";
      $("tabLogin").classList.toggle("active", isLogin);
      $("tabSignup").classList.toggle("active", !isLogin);
      $("formLogin").classList.toggle("hidden", !isLogin);
      $("formSignup").classList.toggle("hidden", isLogin);
      hideAuthMessages();
    }
    function showAuthError(msg){
      const el = $("authError");
      el.textContent = msg;
      el.style.display = "block";
      $("authSuccess").style.display = "none";
    }
    function showAuthSuccess(msg){
      const el = $("authSuccess");
      el.textContent = msg;
      el.style.display = "block";
      $("authError").style.display = "none";
    }
    function hideAuthMessages(){
      $("authError").style.display = "none";
      $("authSuccess").style.display = "none";
    }

    function showSection(mode){
      // mode: auth | onboarding | dashboard
      $("authLayout").classList.toggle("hidden", mode !== "auth");
      $("onboardingSection").classList.toggle("hidden", mode !== "onboarding");
      $("dashboardSection").classList.toggle("hidden", mode !== "dashboard");

      const logged = !!getSession();
      $("btnLogoutTop").classList.toggle("hidden", !logged);
      $("btnGoAuth").classList.toggle("hidden", logged);

      if(mode === "auth"){
        window.scrollTo({ top: $("authCard").offsetTop - 90, behavior: "smooth" });
      } else {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    }

    function updateTopButtons(){
      const hasSession = !!getSession();
      $("btnLogoutTop").classList.toggle("hidden", !hasSession);
      $("btnGoAuth").classList.toggle("hidden", hasSession);
    }

    // ---------- Validation ----------
    function validateEmail(email){
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    // ---------- Password Hash (demo fake) ----------
    // Demo local only. Em produ√ß√£o use auth real (Supabase/Firebase).
    function demoHash(str){
      let h = 0;
      for (let i = 0; i < str.length; i++) {
        h = ((h << 5) - h) + str.charCodeAt(i);
        h |= 0;
      }
      return String(h);
    }

    // ---------- Signup/Login ----------
    function signupUser(payload){
      const users = getUsers();

      if (users.some(u => u.email.toLowerCase() === payload.email.toLowerCase())) {
        return { ok:false, message:"J√° existe uma conta com esse e-mail." };
      }

      const newUser = {
        id: "u_" + Date.now(),
        email: payload.email.trim().toLowerCase(),
        passwordHash: demoHash(payload.password),
        profile: {
          name: payload.name?.trim() || "",
          nick: payload.nick?.trim() || "",
          goal: payload.goal?.trim() || "",
          mainTrack: null
        },
        onboardingCompleted: false,
        assessments: null,
        createdAt: new Date().toISOString()
      };

      users.push(newUser);
      setUsers(users);

      setSession({ userId: newUser.id, email: newUser.email });
      return { ok:true, user:newUser };
    }

    function loginUser(email, password){
      const users = getUsers();
      const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());

      if (!user) return { ok:false, message:"Conta n√£o encontrada. Verifique o e-mail ou crie sua conta." };
      if (user.passwordHash !== demoHash(password)) return { ok:false, message:"Senha incorreta." };

      setSession({ userId: user.id, email: user.email });
      return { ok:true, user };
    }

    function getCurrentUser(){
      const session = getSession();
      if (!session) return null;
      return getUsers().find(u => u.id === session.userId) || null;
    }

    function updateCurrentUser(updater){
      const session = getSession();
      if (!session) return null;

      const users = getUsers();
      const idx = users.findIndex(u => u.id === session.userId);
      if (idx === -1) return null;

      const updated = updater({ ...users[idx] });
      users[idx] = updated;
      setUsers(users);
      return updated;
    }

    // ---------- Onboarding ----------
    function setStep(n){
      onboardingState.step = n;

      [1,2,3,4].forEach(step => {
        $("step" + step).classList.toggle("hidden", step !== n);
      });

      document.querySelectorAll(".step-pill").forEach(el => {
        el.classList.toggle("active", Number(el.dataset.step) === n);
      });

      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function initOnboardingFromCurrentUser(){
      const user = getCurrentUser();
      if (!user) {
        showSection("auth");
        return;
      }

      onboardingState = {
        step: 1,
        selectedTrack: user.profile?.mainTrack || null,
        assessments: user.assessments?.raw || {},
        result: user.assessments?.result || null
      };

      $("obName").value = user.profile?.name || "";
      $("obNick").value = user.profile?.nick || "";
      $("obGoal").value = user.profile?.goal || "";

      renderTrackChoices();
      renderAssessment();
      setStep(1);
      showSection("onboarding");
    }

    function renderTrackChoices(){
      document.querySelectorAll("#mainTrackChoices .choice").forEach(el => {
        const active = el.dataset.track === onboardingState.selectedTrack;
        el.classList.toggle("active", active);
      });
    }

    function initAssessmentDefaults(){
      for (const key of Object.keys(TRACKS)) {
        if (!Array.isArray(onboardingState.assessments[key]) || onboardingState.assessments[key].length !== QUESTIONS.length) {
          onboardingState.assessments[key] = [0,0,0,0,0];
        }
      }
    }

    function renderAssessment(){
      initAssessmentDefaults();
      const wrap = $("assessmentContainer");
      wrap.innerHTML = "";

      for (const [trackKey, meta] of Object.entries(TRACKS)) {
        const values = onboardingState.assessments[trackKey];
        const total = values.reduce((a,b)=>a+b,0);

        const card = document.createElement("div");
        card.className = "ass-card";
        card.innerHTML = `
          <div class="ass-top">
            <div class="ass-title">${meta.emoji} ${meta.label}</div>
            <div class="score-chip" id="chip-${trackKey}">Pontua√ß√£o: ${total}/20</div>
          </div>
          <div class="q" id="q-${trackKey}"></div>
        `;
        wrap.appendChild(card);

        const qWrap = card.querySelector(`#q-${trackKey}`);
        QUESTIONS.forEach((qText, idx) => {
          const row = document.createElement("div");
          row.className = "q-row";
          row.innerHTML = `
            <div class="q-label">${qText}</div>
            <select class="q-select" data-track="${trackKey}" data-index="${idx}">
              <option value="0">0 ‚Ä¢ Nada</option>
              <option value="1">1 ‚Ä¢ Pouco</option>
              <option value="2">2 ‚Ä¢ √Äs vezes</option>
              <option value="3">3 ‚Ä¢ Bastante</option>
              <option value="4">4 ‚Ä¢ Muito</option>
            </select>
          `;
          qWrap.appendChild(row);

          const sel = row.querySelector("select");
          sel.value = String(values[idx]);
          sel.addEventListener("change", (e) => {
            onboardingState.assessments[trackKey][idx] = Number(e.target.value);
            updateTrackChip(trackKey);
          });
        });
      }
    }

    function updateTrackChip(trackKey){
      const total = (onboardingState.assessments[trackKey] || []).reduce((a,b)=>a+b,0);
      const chip = $("chip-" + trackKey);
      if (chip) chip.textContent = `Pontua√ß√£o: ${total}/20`;
    }

    function classifyScore(score){
      if (score <= 4) return { label:"Leve", color:"ok" };
      if (score <= 9) return { label:"Aten√ß√£o", color:"warn" };
      if (score <= 14) return { label:"Moderado", color:"warn" };
      return { label:"Alto", color:"bad" };
    }

    function computeAssessmentResult(){
      const scores = {};
      for (const key of Object.keys(TRACKS)) {
        const arr = onboardingState.assessments[key] || [0,0,0,0,0];
        scores[key] = arr.reduce((a,b)=>a+b,0);
      }

      const sorted = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
      const suggestedMain = sorted[0]?.[0] || onboardingState.selectedTrack || "apostas";
      const chosenMain = onboardingState.selectedTrack || suggestedMain;
      const mainScore = scores[chosenMain];
      const mainLevel = classifyScore(mainScore);

      return {
        scores,
        sorted,
        suggestedMain,
        chosenMain,
        mainLevel
      };
    }

    function fillStep4Result(){
      onboardingState.result = computeAssessmentResult();

      const user = getCurrentUser();
      const displayName = (user?.profile?.nick || user?.profile?.name || user?.email || "Usu√°rio");
      $("rName").textContent = displayName.length > 12 ? displayName.slice(0,12) + "‚Ä¶" : displayName;
      $("rMainTrack").textContent = TRACKS[onboardingState.result.chosenMain].label;
      $("rLevel").textContent = onboardingState.result.mainLevel.label;

      // risk list
      const list = $("resultRiskList");
      list.innerHTML = "";
      Object.entries(onboardingState.result.scores)
        .sort((a,b)=>b[1]-a[1])
        .forEach(([key, score]) => {
          const level = classifyScore(score);
          const row = document.createElement("div");
          row.className = "risk-row";
          row.innerHTML = `
            <div>${TRACKS[key].emoji} ${TRACKS[key].label}</div>
            <div class="risk-bar"><div class="risk-fill" style="width:${(score/20)*100}%"></div></div>
            <div class="risk-num">${score}/20 ‚Ä¢ ${level.label}</div>
          `;
          list.appendChild(row);
        });
    }

    function saveOnboardingToUser(){
      const user = getCurrentUser();
      if (!user) return false;

      const name = $("obName").value.trim();
      const nick = $("obNick").value.trim();
      const goal = $("obGoal").value.trim();

      onboardingState.result = computeAssessmentResult();

      updateCurrentUser((u) => {
        u.profile = {
          ...(u.profile || {}),
          name,
          nick,
          goal,
          mainTrack: onboardingState.selectedTrack || onboardingState.result.suggestedMain
        };
        u.assessments = {
          raw: onboardingState.assessments,
          result: onboardingState.result,
          updatedAt: new Date().toISOString()
        };
        u.onboardingCompleted = true;
        return u;
      });

      return true;
    }

    // ---------- Dashboard ----------
    function getUserCheckins(userId){
      const all = getCheckins();
      return all[userId] || [];
    }
    function setUserCheckins(userId, arr){
      const all = getCheckins();
      all[userId] = arr;
      setCheckins(all);
    }

    function getStreak(arr){
      // streak simples: conta "ok" no final da sequ√™ncia
      let streak = 0;
      for (let i = arr.length - 1; i >= 0; i--) {
        if (arr[i].status === "ok") streak++;
        else break;
      }
      return streak;
    }

    function renderDashboard(){
      const user = getCurrentUser();
      if (!user) {
        showSection("auth");
        return;
      }

      const assessments = user.assessments?.result;
      const profile = user.profile || {};
      const userId = user.id;
      const checkins = getUserCheckins(userId);
      const streak = getStreak(checkins);
      const mainTrack = profile.mainTrack || assessments?.chosenMain || "apostas";
      const mainTrackLabel = TRACKS[mainTrack]?.label || "‚Äî";
      const mainScore = assessments?.scores?.[mainTrack] ?? 0;
      const mainLevel = classifyScore(mainScore);

      $("dashUserEmail").textContent = user.email;
      $("dashName").textContent = profile.nick || profile.name || "Usu√°rio";
      $("dashMainTrack").textContent = mainTrackLabel;
      $("dashMainLevel").textContent = mainLevel.label;
      $("dashCheckins").textContent = String(checkins.length);

      const summaryGoal = profile.goal ? ` Objetivo: ${profile.goal}` : "";
      $("dashQuickSummary").textContent =
        `Sua trilha principal atual √© ${mainTrackLabel} (${mainLevel.label}). Foque em consist√™ncia di√°ria e use o Modo Crise quando a vontade aparecer.${summaryGoal}`;

      // subtitle
      $("dashSubtitle").textContent =
        `Seu foco principal hoje √© ${TRACKS[mainTrack].emoji} ${mainTrackLabel}. Comece pelo Dia 1 e registre seu check-in.`;

      // risk list
      const riskWrap = $("dashRiskList");
      riskWrap.innerHTML = "";
      const resultRisk = assessments?.scores || {};
      Object.entries(TRACKS).forEach(([key, meta]) => {
        const score = resultRisk[key] ?? 0;
        const level = classifyScore(score);
        const row = document.createElement("div");
        row.className = "risk-row";
        row.innerHTML = `
          <div>${meta.emoji} ${meta.label}</div>
          <div class="risk-bar"><div class="risk-fill" style="width:${(score/20)*100}%"></div></div>
          <div class="risk-num">${score}/20 ‚Ä¢ ${level.label}</div>
        `;
        riskWrap.appendChild(row);
      });

      // progress (demo visual = streak)
      const pct = Math.min(100, Math.round((Math.min(streak, 30) / 30) * 100));
      $("mainProgressBar").style.width = pct + "%";
      $("mainProgressText").textContent = `${Math.min(streak,30)}/30 dias (demo visual por sequ√™ncia "n√£o ca√≠")`;

      // badges
      const badgesWrap = $("dashBadges");
      badgesWrap.innerHTML = "";
      const badgeDefs = [
        { n:3,  title:"In√≠cio Forte", desc:"3 dias seguidos sem cair" },
        { n:7,  title:"Primeira Semana", desc:"7 dias seguidos sem cair" },
        { n:14, title:"Fortalecimento", desc:"14 dias seguidos sem cair" },
        { n:30, title:"Reprograma 30", desc:"30 dias seguidos sem cair" }
      ];

      badgeDefs.forEach(b => {
        const unlocked = streak >= b.n;
        const el = document.createElement("div");
        el.className = "badge-item";
        el.innerHTML = `
          <div>
            <div><b>${unlocked ? "üèÖ" : "üîí"} ${b.title}</b></div>
            <div style="color:var(--muted); margin-top:2px">${b.desc}</div>
          </div>
          <div class="status ${unlocked ? "ok" : "lock"}">${unlocked ? "Desbloqueado" : "Bloqueado"}</div>
        `;
        badgesWrap.appendChild(el);
      });

      updateTopButtons();
      showSection("dashboard");
    }

    // ---------- Crisis Protocol ----------
    function openCrisis(){
      alert(
`MODO CRISE ‚Äî REPROGRAMA 30 (3‚Äì7 min)

1) Respire (1‚Äì2 min)
Inspire 4s ‚Ä¢ segure 2s ‚Ä¢ solte 6s

2) Corte o gatilho (30s)
- feche app/aba
- largue o celular
- saia do ambiente

3) Fa√ßa 1 a√ß√£o r√°pida (1‚Äì3 min)
- √°gua
- caminhada curta
- alongamento
- banho
- 10 agachamentos

4) Nomeie a emo√ß√£o
(t√©dio, ansiedade, raiva, solid√£o, estresse)

5) Volte e fa√ßa o check-in

Meta: vencer ESTE momento.`
      );
    }

    // ---------- Demo Helpers ----------
    function fillDemoSignup(){
      switchAuthTab("signup");
      $("signupName").value = "Luigi";
      $("signupNick").value = "Luigi";
      $("signupEmail").value = "luigi.demo@reprograma30.com";
      $("signupPassword").value = "123456";
      $("signupPassword2").value = "123456";
      $("signupGoal").value = "Quero recuperar foco, rotina e reduzir reca√≠das.";
      toast("Campos demo preenchidos.");
    }

    // ---------- Event Listeners ----------
    $("tabLogin").addEventListener("click", () => switchAuthTab("login"));
    $("tabSignup").addEventListener("click", () => switchAuthTab("signup"));
    $("btnToSignup").addEventListener("click", () => switchAuthTab("signup"));
    $("btnToLogin").addEventListener("click", () => switchAuthTab("login"));

    $("btnGoAuth").addEventListener("click", () => showSection("auth"));
    $("btnHeroStart").addEventListener("click", () => showSection("auth"));
    $("btnHeroHow").addEventListener("click", () => {
      alert("Como funciona: compra (Kiwify) ‚Üí cria conta aqui ‚Üí monta perfil ‚Üí autoavalia√ß√£o ‚Üí dashboard ‚Üí trilha.");
    });

    $("btnShowCrisis").addEventListener("click", openCrisis);
    $("btnCrisisDash").addEventListener("click", openCrisis);
    $("btnOpenCrisisCard").addEventListener("click", openCrisis);

    $("btnForgot").addEventListener("click", () => {
      alert("Demo local: reset de senha n√£o est√° conectado.\n\nNa vers√£o com Supabase, eu te entrego reset por e-mail.");
    });

    $("btnDemoFill").addEventListener("click", fillDemoSignup);

    $("btnLogoutTop").addEventListener("click", () => {
      clearSession();
      updateTopButtons();
      switchAuthTab("login");
      showSection("auth");
      toast("Voc√™ saiu da sua conta.");
    });

    // Login submit
    $("formLogin").addEventListener("submit", (e) => {
      e.preventDefault();
      hideAuthMessages();

      const email = $("loginEmail").value.trim().toLowerCase();
      const password = $("loginPassword").value;

      if (!validateEmail(email)) return showAuthError("Digite um e-mail v√°lido.");
      if (!password) return showAuthError("Digite sua senha.");

      const result = loginUser(email, password);
      if (!result.ok) return showAuthError(result.message);

      showAuthSuccess("Login realizado com sucesso.");
      toast("Login realizado.");

      // Se onboarding incompleto, vai pro onboarding. Se completo, dashboard.
      if (result.user.onboardingCompleted) renderDashboard();
      else initOnboardingFromCurrentUser();
    });

    // Signup submit
    $("formSignup").addEventListener("submit", (e) => {
      e.preventDefault();
      hideAuthMessages();

      const name = $("signupName").value.trim();
      const nick = $("signupNick").value.trim();
      const email = $("signupEmail").value.trim().toLowerCase();
      const pass1 = $("signupPassword").value;
      const pass2 = $("signupPassword2").value;
      const goal = $("signupGoal").value.trim();

      if (!name) return showAuthError("Preencha seu nome.");
      if (!validateEmail(email)) return showAuthError("Digite um e-mail v√°lido.");
      if (pass1.length < 6) return showAuthError("A senha deve ter pelo menos 6 caracteres.");
      if (pass1 !== pass2) return showAuthError("As senhas n√£o coincidem.");

      const result = signupUser({ name, nick, email, password: pass1, goal });
      if (!result.ok) return showAuthError(result.message);

      showAuthSuccess("Conta criada com sucesso. Vamos montar seu perfil.");
      toast("Conta criada.");

      setTimeout(() => initOnboardingFromCurrentUser(), 400);
    });

    // Onboarding track choices
    document.querySelectorAll("#mainTrackChoices .choice").forEach(el => {
      el.addEventListener("click", () => {
        onboardingState.selectedTrack = el.dataset.track;
        renderTrackChoices();
      });
    });

    // Onboarding navigation
    $("nextStep1").addEventListener("click", () => {
      const name = $("obName").value.trim();
      if (!name) {
        toast("Preencha seu nome para continuar.");
        $("obName").focus();
        return;
      }
      setStep(2);
    });

    $("backStep2").addEventListener("click", () => setStep(1));
    $("nextStep2").addEventListener("click", () => {
      if (!onboardingState.selectedTrack) {
        toast("Escolha sua trilha principal para continuar.");
        return;
      }
      setStep(3);
    });

    $("backStep3").addEventListener("click", () => setStep(2));
    $("nextStep3").addEventListener("click", () => {
      fillStep4Result();
      setStep(4);
    });

    $("finishOnboarding").addEventListener("click", () => {
      const saved = saveOnboardingToUser();
      if (!saved) {
        toast("Erro ao salvar perfil.");
        return;
      }
      toast("Perfil salvo com sucesso.");
      renderDashboard();
    });

    $("btnRedoAssessment").addEventListener("click", () => {
      initOnboardingFromCurrentUser();
      // pular direto para passo 3 se quiser:
      setStep(3);
      toast("Refa√ßa sua autoavalia√ß√£o.");
    });

    $("btnStartTrack").addEventListener("click", () => {
      const user = getCurrentUser();
      const mainTrack = user?.profile?.mainTrack || "apostas";
      const label = TRACKS[mainTrack]?.label || "Trilha";
      alert(`Abrir trilha principal: ${label}\n\n(Pr√≥ximo passo: eu posso te entregar a p√°gina/√°rea interna completa da trilha ${label} conectada a esse dashboard.)`);
    });

    // Check-in demo
    $("btnSaveCheckin").addEventListener("click", () => {
      const user = getCurrentUser();
      if (!user) return toast("Fa√ßa login.");

      const arr = getUserCheckins(user.id);
      arr.push({
        date: new Date().toISOString(),
        status: $("checkStatus").value,
        urge: Number($("checkUrge").value),
        trigger: $("checkTrigger").value
      });
      setUserCheckins(user.id, arr);

      toast("Check-in salvo.");
      renderDashboard();
    });

    $("btnResetCheckin").addEventListener("click", () => {
      const user = getCurrentUser();
      if (!user) return;

      if (!confirm("Tem certeza que deseja zerar os check-ins (demo local)?")) return;
      setUserCheckins(user.id, []);
      toast("Check-ins zerados.");
      renderDashboard();
    });

    // ---------- Boot ----------
    function hydrateAuthFromSession(){
      updateTopButtons();
      const user = getCurrentUser();

      if (!user) {
        switchAuthTab("login");
        showSection("auth");
        return;
      }

      // Usu√°rio logado
      if (user.onboardingCompleted) renderDashboard();
      else initOnboardingFromCurrentUser();
    }

    // Pr√©-criar avalia√ß√£o na tela
    renderAssessment();
    hydrateAuthFromSession();
  </script>
</body>
</html>
