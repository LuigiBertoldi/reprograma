<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Acessar minha ajuda | Reprograma 30</title>
  <meta name="description" content="Valida√ß√£o de compra, cria√ß√£o de conta e perfil inicial do Reprograma 30." />
  <meta name="theme-color" content="#0b1020" />
  <style>
    :root{
      --bg:#070b14;
      --bg2:#0d1426;
      --panel:rgba(255,255,255,.04);
      --panel2:rgba(255,255,255,.03);
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.16);
      --text:#edf2ff;
      --muted:#aeb7cc;
      --muted2:#8e98ae;
      --accent:#7d5cff;
      --accent2:#2fd4ff;
      --ok:#35d07f;
      --warn:#ffcc66;
      --bad:#ff6b85;
      --shadow:0 20px 70px rgba(0,0,0,.45);
      --r:18px;
      --r-xl:24px;
      --max:1180px;
    }

    *{box-sizing:border-box}
    html,body{
      margin:0;padding:0;color:var(--text);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1000px 650px at 8% 0%, rgba(125,92,255,.20), transparent 58%),
        radial-gradient(900px 700px at 95% 10%, rgba(47,212,255,.12), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      min-height:100vh;
      scroll-behavior:smooth;
    }
    a{color:inherit;text-decoration:none}
    button,input,select{font:inherit}
    .wrap{max-width:var(--max);margin:0 auto;padding:0 18px}
    .hidden{display:none !important}

    /* NAV */
    .nav{
      position:sticky;top:0;z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(7,11,20,.76);
      border-bottom:1px solid var(--line);
    }
    .nav-in{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 0;
    }
    .brand{display:flex;align-items:center;gap:12px;min-width:0}
    .logo{
      width:40px;height:40px;border-radius:14px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow:0 12px 35px rgba(125,92,255,.25);
      display:grid;place-items:center;
      color:#06101c;font-weight:900;font-size:14px;
      flex:0 0 auto;
    }
    .brand-text{min-width:0}
    .brand-title{font-weight:900;font-size:15px;line-height:1.05}
    .brand-sub{
      color:var(--muted);font-size:12px;line-height:1.1;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }

    .nav-actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{
      border:1px solid transparent;background:transparent;color:var(--text);
      padding:11px 14px;border-radius:999px;font-weight:800;font-size:14px;
      cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:8px;
      transition:.16s ease;text-align:center;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:none}
    .btn-primary{
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:#07101d;
      box-shadow:0 12px 35px rgba(125,92,255,.22);
    }
    .btn-ghost{
      border-color:var(--line);
      background:rgba(255,255,255,.03);
    }
    .btn-soft{
      border-color:rgba(255,255,255,.08);
      background:rgba(255,255,255,.04);
    }
    .btn-danger{
      border-color:rgba(255,107,133,.25);
      background:rgba(255,107,133,.10);
      color:#ffd2dc;
    }
    .btn-sm{padding:9px 12px;font-size:13px}
    .btn-full{width:100%}

    /* HERO */
    .hero{
      margin-top:18px;
      border:1px solid var(--line);
      border-radius:var(--r-xl);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow:var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .hero::before{
      content:"";
      position:absolute;right:-120px;top:-110px;width:300px;height:300px;border-radius:50%;
      background:radial-gradient(circle, rgba(47,212,255,.18), transparent 62%);
      pointer-events:none;
    }
    .hero-in{
      position:relative;
      z-index:1;
      display:grid;grid-template-columns:1.1fr .9fr;gap:14px;
      padding:18px;
      align-items:stretch;
    }

    .card{
      border:1px solid var(--line);
      background:var(--panel);
      border-radius:var(--r);
      padding:16px;
    }
    .card h2,.card h3{margin:0 0 8px}
    .card p{margin:0;color:var(--muted);font-size:13px;line-height:1.6}
    .divider{height:1px;background:var(--line);margin:12px 0}
    .small{font-size:12px;color:var(--muted);line-height:1.55}
    .muted{color:var(--muted)}

    .pill-row{display:flex;gap:8px;flex-wrap:wrap}
    .pill{
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      font-weight:700;
    }
    .dot{
      width:8px;height:8px;border-radius:50%;background:var(--ok);
      display:inline-block;margin-right:6px;box-shadow:0 0 0 4px rgba(53,208,127,.14)
    }

    h1{
      margin:10px 0 8px;
      font-size:clamp(28px, 4vw, 44px);
      line-height:1.04;
      letter-spacing:-.6px;
    }

    .hero-list{
      list-style:none;padding:0;margin:12px 0 0;display:grid;gap:8px;
    }
    .hero-list li{
      display:flex;gap:10px;align-items:flex-start;font-size:13px;color:var(--muted);line-height:1.45;
    }
    .check{
      width:18px;height:18px;border-radius:6px;flex:0 0 auto;
      display:grid;place-items:center;font-size:12px;font-weight:900;
      border:1px solid rgba(53,208,127,.28);
      background:rgba(53,208,127,.12);
      color:var(--ok);
      margin-top:1px;
    }

    /* GRID MAIN */
    section{padding:24px 0}
    .layout{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
      align-items:start;
    }

    .panel{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
      border-radius:18px;
      padding:16px;
      box-shadow:var(--shadow);
    }
    .panel h3{margin:0 0 6px;font-size:20px;letter-spacing:-.3px}
    .panel > p{margin:0;color:var(--muted);font-size:13px;line-height:1.55}

    .steps{
      display:grid;gap:10px;margin-top:12px;
    }
    .step{
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
      border-radius:14px;
      padding:12px;
      display:flex;gap:10px;align-items:flex-start;
    }
    .step-num{
      width:26px;height:26px;border-radius:9px;
      display:grid;place-items:center;font-weight:900;font-size:12px;
      color:#07101d;background:linear-gradient(135deg,var(--accent),var(--accent2));
      flex:0 0 auto;
    }
    .step h4{margin:0 0 3px;font-size:14px}
    .step p{margin:0;font-size:12px;color:var(--muted);line-height:1.45}

    /* FORM */
    .tabs{
      display:grid;grid-template-columns:1fr 1fr;
      gap:8px;
      padding:6px;
      border-radius:14px;
      background:rgba(255,255,255,.02);
      border:1px solid var(--line);
      margin-top:12px;
    }
    .tab{
      border:1px solid transparent;
      border-radius:10px;
      padding:10px 12px;
      font-weight:800;
      color:var(--muted);
      background:transparent;
      cursor:pointer;
    }
    .tab.active{
      color:var(--text);
      background:rgba(255,255,255,.04);
      border-color:rgba(255,255,255,.08);
    }

    .field{margin-top:12px}
    .label{
      display:block;
      font-size:12px;font-weight:700;color:var(--muted);
      margin-bottom:6px;
    }
    .input, .select{
      width:100%;
      border:1px solid var(--line2);
      background:rgba(255,255,255,.03);
      color:var(--text);
      border-radius:12px;
      padding:12px 13px;
      outline:none;
      transition:.14s ease;
    }
    .input:focus, .select:focus{
      border-color:rgba(47,212,255,.45);
      box-shadow:0 0 0 4px rgba(47,212,255,.08);
    }

    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }

    .hint{
      font-size:12px;color:var(--muted2);margin-top:8px;line-height:1.4;
    }

    .msg{
      margin-top:12px;
      border-radius:12px;
      border:1px solid var(--line);
      padding:10px 12px;
      font-size:13px;
      display:none;
    }
    .msg.show{display:block}
    .msg.ok{
      border-color:rgba(53,208,127,.28);
      background:rgba(53,208,127,.08);
      color:#c9f8de;
    }
    .msg.bad{
      border-color:rgba(255,107,133,.28);
      background:rgba(255,107,133,.08);
      color:#ffd3dc;
    }
    .msg.warn{
      border-color:rgba(255,204,102,.24);
      background:rgba(255,204,102,.08);
      color:#ffe5b5;
    }

    .status-line{
      margin-top:12px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
      font-size:13px;
      color:var(--muted);
    }
    .status-line b{color:var(--text)}

    .gate-locked{
      border:1px solid rgba(255,204,102,.22);
      background:rgba(255,204,102,.05);
      color:#ffe4b1;
      border-radius:12px;
      padding:10px 12px;
      font-size:13px;
      margin-top:12px;
    }

    /* CHECK LIST */
    .list{
      margin:10px 0 0;padding:0;list-style:none;display:grid;gap:8px;
    }
    .list li{
      display:flex;gap:10px;align-items:flex-start;
      color:var(--muted);font-size:13px;line-height:1.45;
    }

    .badge{
      display:inline-flex;align-items:center;gap:6px;
      font-size:11px;font-weight:700;
      border-radius:999px;padding:5px 8px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
      color:var(--muted);
    }
    .badge.ok{
      border-color:rgba(53,208,127,.25);
      background:rgba(53,208,127,.08);
      color:#c7f5dd;
    }
    .badge.warn{
      border-color:rgba(255,204,102,.25);
      background:rgba(255,204,102,.08);
      color:#ffe7bc;
    }

    /* PROFILE */
    .profile-box{
      margin-top:14px;
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(255,255,255,.02);
      padding:14px;
    }
    .profile-grid{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
      margin-top:10px;
    }
    .score{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      background:rgba(255,255,255,.02);
    }
    .score .top{
      display:flex;justify-content:space-between;gap:8px;align-items:center;
      margin-bottom:8px;
    }
    .score b{font-size:13px}
    .score span{font-size:11px;color:var(--muted)}
    .range{
      width:100%;
      accent-color:#7d5cff;
    }

    .progress{
      height:10px;border-radius:999px;background:rgba(255,255,255,.07);overflow:hidden;
      margin-top:8px;border:1px solid rgba(255,255,255,.04);
    }
    .bar{
      height:100%;width:0%;
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      transition:width .25s ease;
    }

    .result-card{
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:rgba(255,255,255,.02);
    }
    .result-card h4{margin:0 0 6px;font-size:14px}
    .result-card p{margin:0;color:var(--muted);font-size:13px;line-height:1.5}

    /* FOOTER */
    footer{
      padding:24px 0 36px;
      border-top:1px solid var(--line);
      margin-top:10px;
    }
    .foot{
      display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap;
    }
    .foot p{margin:0;color:var(--muted2);font-size:12px;line-height:1.55}

    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      border:1px solid var(--line);
      background:rgba(0,0,0,.7);
      color:var(--text);
      border-radius:999px;
      padding:10px 12px;
      font-size:13px;
      display:none;
      z-index:90;
      backdrop-filter:blur(10px);
    }

    @media (max-width: 980px){
      .hero-in,.layout{grid-template-columns:1fr}
    }
    @media (max-width: 680px){
      .nav-in{flex-direction:column;align-items:flex-start}
      .nav-actions{width:100%}
      .nav-actions .btn{flex:1}
      .row,.profile-grid{grid-template-columns:1fr}
      .hero{margin-top:12px}
      .panel,.card{padding:14px}
      h1{font-size:34px}
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <div class="wrap nav-in">
      <a class="brand" href="./index.html" aria-label="Voltar para p√°gina inicial">
        <div class="logo">R30</div>
        <div class="brand-text">
          <div class="brand-title">Reprograma 30</div>
          <div class="brand-sub">Acessar minha ajuda ‚Ä¢ √Årea personalizada</div>
        </div>
      </a>

      <div class="nav-actions">
        <button class="btn btn-danger btn-sm" id="btnCrisisTop">Modo crise</button>
        <a class="btn btn-ghost btn-sm" href="./index.html">Voltar ao site</a>
      </div>
    </div>
  </div>

  <main class="wrap">
    <!-- HERO -->
    <section class="hero">
      <div class="hero-in">
        <div class="card" style="background:rgba(255,255,255,.02)">
          <div class="pill-row">
            <span class="pill"><span class="dot"></span>Apoio educacional/comportamental</span>
            <span class="pill">P√≥s-compra ‚Ä¢ Valida√ß√£o por e-mail</span>
          </div>

          <h1>Seu acesso come√ßa<br>com a valida√ß√£o da compra.</h1>

          <p class="muted" style="font-size:14px;line-height:1.6;margin:0">
            Para proteger sua √°rea e liberar o conte√∫do certo, o acesso ao Reprograma 30 √© feito em etapas:
            <b>validar compra pelo e-mail</b> ‚Üí <b>criar conta / entrar</b> ‚Üí <b>montar perfil</b>.
          </p>

          <ul class="hero-list">
            <li><span class="check">‚úì</span><span>Quem n√£o comprou n√£o deve conseguir entrar</span></li>
            <li><span class="check">‚úì</span><span>Quem comprou usa o e-mail da compra para valida√ß√£o</span></li>
            <li><span class="check">‚úì</span><span>Depois cria senha e configura o perfil inicial</span></li>
          </ul>

          <div class="divider"></div>
          <p class="small">
            Aviso: este ambiente √© de apoio educacional/comportamental e n√£o substitui atendimento m√©dico, psicol√≥gico ou psiqui√°trico.
          </p>
        </div>

        <div class="card" style="background:rgba(255,255,255,.02)">
          <h3 style="font-size:16px">Fluxo recomendado (p√≥s-compra)</h3>
          <div class="steps">
            <div class="step">
              <div class="step-num">1</div>
              <div>
                <h4>Compra confirmada (Kiwify)</h4>
                <p>Pagamento aprovado na Kiwify.</p>
              </div>
            </div>
            <div class="step">
              <div class="step-num">2</div>
              <div>
                <h4>E-mail recebido</h4>
                <p>Cliente recebe confirma√ß√£o da compra no e-mail.</p>
              </div>
            </div>
            <div class="step">
              <div class="step-num">3</div>
              <div>
                <h4>Valida√ß√£o do e-mail da compra</h4>
                <p>Somente e-mails com compra aprovada avan√ßam.</p>
              </div>
            </div>
            <div class="step">
              <div class="step-num">4</div>
              <div>
                <h4>Criar conta / Entrar</h4>
                <p>Senha + dados b√°sicos da conta.</p>
              </div>
            </div>
            <div class="step">
              <div class="step-num">5</div>
              <div>
                <h4>Perfil inicial e trilha sugerida</h4>
                <p>Autoavalia√ß√£o para orientar foco inicial.</p>
              </div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="badge ok">‚úÖ Fluxo correto</div>
          <div class="badge warn">‚ö†Ô∏è Valida√ß√£o real precisa backend/webhook</div>
        </div>
      </div>
    </section>

    <section>
      <div class="layout">
        <!-- COLUNA ESQUERDA: GATE DE VALIDA√á√ÉO + LOGIN -->
        <div class="panel">
          <h3>Acessar minha ajuda</h3>
          <p>Primeiro valide o e-mail usado na compra. Depois voc√™ poder√° criar conta ou entrar.</p>

          <!-- ETAPA 1: VALIDAR COMPRA -->
          <div class="profile-box">
            <h4 style="margin:0 0 6px;font-size:15px">1) Validar compra pelo e-mail</h4>
            <p class="small" style="margin:0">
              Use o mesmo e-mail da compra na Kiwify.
            </p>

            <div class="field">
              <label class="label" for="purchaseEmail">E-mail da compra</label>
              <input class="input" id="purchaseEmail" type="email" placeholder="voce@email.com" />
            </div>

            <div class="row">
              <button class="btn btn-primary btn-full" id="btnValidate">Validar compra</button>
              <button class="btn btn-ghost btn-full" id="btnDemoFill">Preencher demo</button>
            </div>

            <div id="validationMsg" class="msg"></div>

            <div class="hint">
              <b>Demo atual:</b> para testar visualmente, o sistema aceita e-mails que contenham
              <code style="color:#dce9ff;background:rgba(255,255,255,.04);padding:2px 5px;border-radius:6px;border:1px solid rgba(255,255,255,.08)">comprou</code>
              ou
              <code style="color:#dce9ff;background:rgba(255,255,255,.04);padding:2px 5px;border-radius:6px;border:1px solid rgba(255,255,255,.08)">kiwify</code>
              (ex.: <b>luigi+comprou@gmail.com</b>).
            </div>
          </div>

          <!-- ETAPA 2: LOGIN/CRIAR CONTA (BLOQUEADO AT√â VALIDAR) -->
          <div class="profile-box">
            <h4 style="margin:0 0 6px;font-size:15px">2) Criar conta / Entrar</h4>
            <p class="small" style="margin:0">
              Esta etapa s√≥ √© liberada ap√≥s valida√ß√£o do e-mail da compra.
            </p>

            <div id="gateLocked" class="gate-locked">
              üîí Bloqueado at√© validar compra pelo e-mail.
            </div>

            <div id="authArea" class="hidden">
              <div class="tabs">
                <button class="tab active" id="tabLogin" type="button">Entrar</button>
                <button class="tab" id="tabRegister" type="button">Criar conta</button>
              </div>

              <!-- LOGIN -->
              <div id="loginForm">
                <div class="field">
                  <label class="label" for="loginEmail">E-mail</label>
                  <input class="input" id="loginEmail" type="email" placeholder="seu e-mail validado" />
                </div>
                <div class="field">
                  <label class="label" for="loginPass">Senha</label>
                  <input class="input" id="loginPass" type="password" placeholder="Digite sua senha" />
                </div>
                <button class="btn btn-primary btn-full" id="btnLogin">Entrar na minha √°rea</button>
                <div id="loginMsg" class="msg"></div>
              </div>

              <!-- REGISTER -->
              <div id="registerForm" class="hidden">
                <div class="field">
                  <label class="label" for="regName">Nome</label>
                  <input class="input" id="regName" type="text" placeholder="Seu nome" />
                </div>
                <div class="field">
                  <label class="label" for="regEmail">E-mail</label>
                  <input class="input" id="regEmail" type="email" placeholder="E-mail validado" />
                </div>
                <div class="row">
                  <div class="field" style="margin-top:0">
                    <label class="label" for="regPass">Senha</label>
                    <input class="input" id="regPass" type="password" placeholder="Crie sua senha" />
                  </div>
                  <div class="field" style="margin-top:0">
                    <label class="label" for="regPass2">Confirmar senha</label>
                    <input class="input" id="regPass2" type="password" placeholder="Repita a senha" />
                  </div>
                </div>
                <button class="btn btn-primary btn-full" id="btnRegister">Criar conta e continuar</button>
                <div id="registerMsg" class="msg"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- COLUNA DIREITA: PERFIL INICIAL (BLOQUEADO AT√â LOGIN/CRIAR CONTA) -->
        <div class="panel">
          <h3>Perfil inicial (autoavalia√ß√£o)</h3>
          <p>
            Ap√≥s validar compra e entrar/criar conta, a pessoa responde uma autoavalia√ß√£o inicial para orientar a trilha principal.
          </p>

          <div id="profileLocked" class="gate-locked">
            üîí Bloqueado at√© validar compra e concluir login/cria√ß√£o de conta.
          </div>

          <div id="profileArea" class="hidden">
            <div class="status-line" id="statusLine">
              Status: <b>Compra validada</b> ‚Ä¢ Conta n√£o autenticada
            </div>

            <div class="profile-box">
              <h4 style="margin:0 0 6px;font-size:15px">Dados r√°pidos</h4>
              <div class="row">
                <div class="field" style="margin-top:0">
                  <label class="label" for="perfilNome">Nome / apelido</label>
                  <input class="input" id="perfilNome" type="text" placeholder="Ex.: Luigi" />
                </div>
                <div class="field" style="margin-top:0">
                  <label class="label" for="perfilObjetivo">Objetivo principal</label>
                  <select class="select" id="perfilObjetivo">
                    <option value="">Selecione</option>
                    <option>Parar totalmente</option>
                    <option>Retomar controle</option>
                    <option>Reduzir reca√≠das</option>
                    <option>Construir rotina</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="profile-box">
              <h4 style="margin:0 0 6px;font-size:15px">N√≠vel de impacto percebido (0‚Äì10)</h4>
              <p class="small" style="margin:0 0 8px">
                N√£o √© diagn√≥stico cl√≠nico. √â um mapa inicial para sugerir foco.
              </p>

              <div class="profile-grid">
                <div class="score">
                  <div class="top"><b>üéØ Apostas</b><span id="v_apostas">5</span></div>
                  <input class="range" id="apostas" type="range" min="0" max="10" value="5">
                </div>
                <div class="score">
                  <div class="top"><b>üç∫ √Ålcool</b><span id="v_alcool">5</span></div>
                  <input class="range" id="alcool" type="range" min="0" max="10" value="5">
                </div>
                <div class="score">
                  <div class="top"><b>üö¨ Fumar</b><span id="v_fumar">5</span></div>
                  <input class="range" id="fumar" type="range" min="0" max="10" value="5">
                </div>
                <div class="score">
                  <div class="top"><b>üß† Pornografia</b><span id="v_porno">5</span></div>
                  <input class="range" id="porno" type="range" min="0" max="10" value="5">
                </div>
                <div class="score" style="grid-column:1 / -1">
                  <div class="top"><b>‚ö†Ô∏è Drogas</b><span id="v_drogas">5</span></div>
                  <input class="range" id="drogas" type="range" min="0" max="10" value="5">
                </div>
              </div>

              <button class="btn btn-primary btn-full" style="margin-top:12px" id="btnPerfil">
                Salvar perfil e sugerir trilha principal
              </button>

              <div id="perfilMsg" class="msg"></div>

              <div class="result-card hidden" id="resultadoTrilha">
                <h4 id="trilhaTitulo">Trilha sugerida</h4>
                <p id="trilhaTexto">‚Äî</p>
                <div class="progress"><div class="bar" id="perfilBar"></div></div>
                <div class="small" style="margin-top:8px">
                  Pr√≥ximo passo: iniciar check-in di√°rio e plano de crise dentro da √°rea.
                </div>
              </div>
            </div>
          </div>

          <div class="profile-box" style="margin-top:14px">
            <h4 style="margin:0 0 6px;font-size:15px">O que vem depois</h4>
            <ul class="list">
              <li><span class="check">‚úì</span><span>Trilha principal sugerida</span></li>
              <li><span class="check">‚úì</span><span>Check-in di√°rio e progresso</span></li>
              <li><span class="check">‚úì</span><span>Modo crise (a√ß√£o r√°pida)</span></li>
              <li><span class="check">‚úì</span><span>Metas, badges e retomada</span></li>
            </ul>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap foot">
      <p>
        <b style="color:var(--text)">Reprograma 30</b> ‚Ä¢ √Årea de acesso (p√≥s-compra) ‚Ä¢ Apoio educacional/comportamental
      </p>
      <p>¬© <span id="year"></span> Reprograma 30.</p>
    </div>
  </footer>

  <div class="toast" id="toast"></div>

  <script>
    const $ = (id) => document.getElementById(id);

    const state = {
      purchaseValidated: false,
      validatedEmail: "",
      authenticated: false,
      mode: "login" // login | register
    };

    function toast(msg){
      const el = $("toast");
      el.textContent = msg;
      el.style.display = "block";
      clearTimeout(window.__t);
      window.__t = setTimeout(() => el.style.display = "none", 2200);
    }

    function setMsg(id, type, text){
      const el = $(id);
      el.className = "msg show " + type;
      el.textContent = text;
    }
    function clearMsg(id){
      const el = $(id);
      el.className = "msg";
      el.textContent = "";
    }

    function crisisMode(){
      alert(
`MODO CRISE ‚Äî REPROGRAMA 30 (3‚Äì7 min)

1) Respire: 4s inspirar ‚Ä¢ 2s segurar ‚Ä¢ 6s soltar
2) Feche app/aba e afaste o gatilho
3) Saia do ambiente por 2‚Äì5 min
4) Fa√ßa 1 a√ß√£o r√°pida:
   - √°gua
   - caminhada curta
   - banho
   - alongamento
5) Volte e fa√ßa seu check-in

Meta: vencer ESTE momento.`
      );
    }
    $("btnCrisisTop").addEventListener("click", crisisMode);

    $("year").textContent = new Date().getFullYear();

    // Tabs
    const tabLogin = $("tabLogin");
    const tabRegister = $("tabRegister");
    const loginForm = $("loginForm");
    const registerForm = $("registerForm");

    function setAuthMode(mode){
      state.mode = mode;
      if(mode === "login"){
        tabLogin.classList.add("active");
        tabRegister.classList.remove("active");
        loginForm.classList.remove("hidden");
        registerForm.classList.add("hidden");
      }else{
        tabRegister.classList.add("active");
        tabLogin.classList.remove("active");
        registerForm.classList.remove("hidden");
        loginForm.classList.add("hidden");
      }
    }
    tabLogin.addEventListener("click", ()=> setAuthMode("login"));
    tabRegister.addEventListener("click", ()=> setAuthMode("register"));

    // Demo fill
    $("btnDemoFill").addEventListener("click", () => {
      $("purchaseEmail").value = "luigi+comprou@gmail.com";
      toast("E-mail demo preenchido.");
    });

    // Simula√ß√£o de valida√ß√£o (DEMO)
    function fakeValidatePurchase(email){
      // DEMO VISUAL: aceita se tiver "comprou" ou "kiwify"
      // TROCAR por API/backend real depois
      const e = (email || "").toLowerCase().trim();
      return e.includes("comprou") || e.includes("kiwify");
    }

    function unlockAuthArea(email){
      state.purchaseValidated = true;
      state.validatedEmail = email;
      $("gateLocked").classList.add("hidden");
      $("authArea").classList.remove("hidden");

      // Pr√©-preenche e trava coer√™ncia visual
      $("loginEmail").value = email;
      $("regEmail").value = email;

      $("loginEmail").readOnly = true;
      $("regEmail").readOnly = true;

      $("profileLocked").classList.remove("hidden");
      $("profileArea").classList.remove("hidden"); // mostra √°rea, mas status ainda diz n√£o autenticado
      updateStatusLine();

      toast("Compra validada. Agora crie sua conta ou entre.");
    }

    $("btnValidate").addEventListener("click", () => {
      clearMsg("validationMsg");
      const email = $("purchaseEmail").value.trim();

      if(!email){
        setMsg("validationMsg", "bad", "Digite o e-mail usado na compra.");
        return;
      }
      if(!email.includes("@") || email.length < 6){
        setMsg("validationMsg", "bad", "Digite um e-mail v√°lido.");
        return;
      }

      if(fakeValidatePurchase(email)){
        setMsg("validationMsg", "ok", "Compra validada com sucesso (demo). Acesso liberado para criar conta/entrar.");
        unlockAuthArea(email);
      }else{
        setMsg("validationMsg", "bad", "N√£o encontramos compra aprovada para este e-mail (demo). Verifique o e-mail da compra.");
      }
    });

    // Login (demo)
    $("btnLogin").addEventListener("click", () => {
      clearMsg("loginMsg");
      const email = $("loginEmail").value.trim();
      const pass = $("loginPass").value;

      if(!state.purchaseValidated){
        setMsg("loginMsg", "bad", "Valide a compra antes de entrar.");
        return;
      }
      if(email !== state.validatedEmail){
        setMsg("loginMsg", "bad", "Use o mesmo e-mail validado na compra.");
        return;
      }
      if(!pass || pass.length < 4){
        setMsg("loginMsg", "bad", "Digite sua senha.");
        return;
      }

      // DEMO: login local
      state.authenticated = true;
      setMsg("loginMsg", "ok", "Entrada realizada (demo). Perfil inicial liberado.");
      $("profileLocked").classList.add("hidden");
      updateStatusLine();
      toast("Entrou na √°rea (demo).");
    });

    // Register (demo)
    $("btnRegister").addEventListener("click", () => {
      clearMsg("registerMsg");
      const name = $("regName").value.trim();
      const email = $("regEmail").value.trim();
      const p1 = $("regPass").value;
      const p2 = $("regPass2").value;

      if(!state.purchaseValidated){
        setMsg("registerMsg", "bad", "Valide a compra antes de criar conta.");
        return;
      }
      if(!name){
        setMsg("registerMsg", "bad", "Digite seu nome.");
        return;
      }
      if(email !== state.validatedEmail){
        setMsg("registerMsg", "bad", "Use o mesmo e-mail validado na compra.");
        return;
      }
      if(p1.length < 6){
        setMsg("registerMsg", "bad", "A senha deve ter pelo menos 6 caracteres.");
        return;
      }
      if(p1 !== p2){
        setMsg("registerMsg", "bad", "As senhas n√£o coincidem.");
        return;
      }

      // DEMO: salva localmente
      localStorage.setItem("rp30_demo_user", JSON.stringify({ name, email }));
      state.authenticated = true;

      $("perfilNome").value = name;

      setMsg("registerMsg", "ok", "Conta criada com sucesso (demo). Perfil inicial liberado.");
      $("profileLocked").classList.add("hidden");
      updateStatusLine();
      toast("Conta criada (demo).");
    });

    function updateStatusLine(){
      const status = $("statusLine");
      if(!state.purchaseValidated){
        status.innerHTML = 'Status: <b>Compra n√£o validada</b> ‚Ä¢ Acesso bloqueado';
        return;
      }
      if(state.purchaseValidated && !state.authenticated){
        status.innerHTML = 'Status: <b>Compra validada</b> ‚Ä¢ Conta n√£o autenticada';
        return;
      }
      status.innerHTML = 'Status: <b>Compra validada</b> ‚Ä¢ <b>Conta autenticada</b> ‚Ä¢ Pronto para configurar perfil';
    }

    // Sliders
    const sliderMap = [
      ["apostas","v_apostas"],
      ["alcool","v_alcool"],
      ["fumar","v_fumar"],
      ["porno","v_porno"],
      ["drogas","v_drogas"]
    ];

    sliderMap.forEach(([id, out])=>{
      const r = $(id), s = $(out);
      r.addEventListener("input", ()=> s.textContent = r.value);
    });

    // Perfil / trilha sugerida
    const trilhaTextos = {
      apostas: "Sua trilha principal sugerida √© Apostas. Foque em gatilhos digitais, interrup√ß√£o do impulso e reconstru√ß√£o de controle financeiro/emocional.",
      alcool: "Sua trilha principal sugerida √© √Ålcool. Foque em gatilhos sociais, prote√ß√£o de ambiente e rotina para finais de semana.",
      fumar: "Sua trilha principal sugerida √© Fumar. Foque em substitui√ß√£o de pausas, gatilhos autom√°ticos e plano para ansiedade.",
      porno: "Sua trilha principal sugerida √© Pornografia. Foque em barreiras digitais, hor√°rios cr√≠ticos e reconstru√ß√£o de foco/energia.",
      drogas: "Sua trilha principal sugerida √© Drogas. Foque em ambiente, redu√ß√£o de exposi√ß√£o, suporte e plano de prote√ß√£o."
    };

    $("btnPerfil").addEventListener("click", () => {
      clearMsg("perfilMsg");

      if(!state.purchaseValidated || !state.authenticated){
        setMsg("perfilMsg", "bad", "Valide a compra e conclua login/cria√ß√£o de conta antes de salvar o perfil.");
        return;
      }

      const nome = $("perfilNome").value.trim();
      const objetivo = $("perfilObjetivo").value;

      if(!nome){
        setMsg("perfilMsg", "bad", "Digite seu nome/apelido.");
        return;
      }
      if(!objetivo){
        setMsg("perfilMsg", "bad", "Selecione seu objetivo principal.");
        return;
      }

      const scores = {
        apostas: Number($("apostas").value),
        alcool: Number($("alcool").value),
        fumar: Number($("fumar").value),
        porno: Number($("porno").value),
        drogas: Number($("drogas").value)
      };

      const top = Object.entries(scores).sort((a,b)=> b[1]-a[1])[0];
      const trilha = top[0];
      const nota = top[1];

      // salva demo local
      localStorage.setItem("rp30_demo_profile", JSON.stringify({
        nome, objetivo, scores, trilhaPrincipal: trilha
      }));

      $("resultadoTrilha").classList.remove("hidden");
      $("trilhaTitulo").textContent = `Trilha principal sugerida: ${labelTrilha(trilha)} (${nota}/10)`;
      $("trilhaTexto").textContent = trilhaTextos[trilha];
      $("perfilBar").style.width = Math.min(100, nota * 10) + "%";

      setMsg("perfilMsg", "ok", "Perfil salvo (demo). Trilha principal sugerida com sucesso.");
      toast("Perfil salvo.");
    });

    function labelTrilha(key){
      return {
        apostas:"Apostas",
        alcool:"√Ålcool",
        fumar:"Fumar",
        porno:"Pornografia",
        drogas:"Drogas"
      }[key] || key;
    }

    // Initial
    updateStatusLine();

    // Toast on index links
    document.querySelectorAll('a[href="./index.html"]').forEach(a=>{
      a.addEventListener("click", ()=> toast("Voltando para o site..."));
    });
  </script>
</body>
</html>
